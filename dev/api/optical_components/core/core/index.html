<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API · FluxOptics.jl</title><meta name="title" content="API · FluxOptics.jl"/><meta property="og:title" content="API · FluxOptics.jl"/><meta property="twitter:title" content="API · FluxOptics.jl"/><meta name="description" content="Documentation for FluxOptics.jl."/><meta property="og:description" content="Documentation for FluxOptics.jl."/><meta property="twitter:description" content="Documentation for FluxOptics.jl."/><meta property="og:url" content="https://anscoil.github.io/FluxOptics.jl/api/optical_components/core/core/"/><meta property="twitter:url" content="https://anscoil.github.io/FluxOptics.jl/api/optical_components/core/core/"/><link rel="canonical" href="https://anscoil.github.io/FluxOptics.jl/api/optical_components/core/core/"/><script data-outdated-warner src="../../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../../assets/documenter.js"></script><script src="../../../../search_index.js"></script><script src="../../../../siteinfo.js"></script><script src="../../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../../"><img src="../../../../assets/logo.svg" alt="FluxOptics.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../../">FluxOptics.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../../">Home</a></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../../../">API Reference</a></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">GridUtils</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../gridutils/">GridUtils</a></li><li><a class="tocitem" href="../../../gridutils/gridutils/">API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox"/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Modes</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../modes/">Modes</a></li><li><a class="tocitem" href="../../../modes/modes/">API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Fields</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../fields/">Fields</a></li><li><a class="tocitem" href="../../../fields/fields/">API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox" checked/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Optical Components</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../">Optical Components</a></li><li><input class="collapse-toggle" id="menuitem-2-5-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2-5-2"><span class="docs-label">Core</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../">Core</a></li><li class="is-active"><a class="tocitem" href>API</a><ul class="internal"><li><a class="tocitem" href="#Abstract-Types"><span>Abstract Types</span></a></li><li><a class="tocitem" href="#Trainability-System"><span>Trainability System</span></a></li><li><a class="tocitem" href="#Propagation"><span>Propagation</span></a></li><li><a class="tocitem" href="#Component-Interface"><span>Component Interface</span></a></li><li><a class="tocitem" href="#Technical-Notes"><span>Technical Notes</span></a></li><li><a class="tocitem" href="#Common-Patterns"><span>Common Patterns</span></a></li><li><a class="tocitem" href="#See-Also"><span>See Also</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5-3" type="checkbox"/><label class="tocitem" for="menuitem-2-5-3"><span class="docs-label">Sources</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../sources/">Sources</a></li><li><a class="tocitem" href="../../sources/sources/">API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5-4" type="checkbox"/><label class="tocitem" for="menuitem-2-5-4"><span class="docs-label">Modulators</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../modulators/">Modulators</a></li><li><a class="tocitem" href="../../modulators/modulators/">API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5-5" type="checkbox"/><label class="tocitem" for="menuitem-2-5-5"><span class="docs-label">Fourier</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../fourier/">Fourier</a></li><li><a class="tocitem" href="../../fourier/fourier/">API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5-6" type="checkbox"/><label class="tocitem" for="menuitem-2-5-6"><span class="docs-label">Utilities</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../utilities/">Utilities</a></li><li><a class="tocitem" href="../../utilities/utilities/">API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5-7" type="checkbox"/><label class="tocitem" for="menuitem-2-5-7"><span class="docs-label">Free-Space Propagators</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../freespace/">Free-Space Propagators</a></li><li><a class="tocitem" href="../../freespace/freespace/">API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5-8" type="checkbox"/><label class="tocitem" for="menuitem-2-5-8"><span class="docs-label">Bulk Propagators</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../bulk/">Bulk Propagators</a></li><li><a class="tocitem" href="../../bulk/bulk/">API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5-9" type="checkbox"/><label class="tocitem" for="menuitem-2-5-9"><span class="docs-label">Active Media</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../active/">Active Media</a></li><li><a class="tocitem" href="../../active/active_media/">API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5-10" type="checkbox"/><label class="tocitem" for="menuitem-2-5-10"><span class="docs-label">System</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../system/">System</a></li><li><a class="tocitem" href="../../system/system/">API</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-6" type="checkbox"/><label class="tocitem" for="menuitem-2-6"><span class="docs-label">OptimisersExt</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../optimisers/">OptimisersExt</a></li><li><a class="tocitem" href="../../../optimisers/optimisers/">API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-7" type="checkbox"/><label class="tocitem" for="menuitem-2-7"><span class="docs-label">Metrics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../metrics/">Metrics</a></li><li><a class="tocitem" href="../../../metrics/metrics/">API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-8" type="checkbox"/><label class="tocitem" for="menuitem-2-8"><span class="docs-label">Plotting</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../plotting/">Plotting</a></li><li><a class="tocitem" href="../../../plotting/plotting/">API</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Reference</a></li><li><a class="is-disabled">Optical Components</a></li><li><a class="is-disabled">Core</a></li><li class="is-active"><a href>API</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>API</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/anscoil/FluxOptics.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/anscoil/FluxOptics.jl/blob/main/docs/src/api/optical_components/core/core.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Core-API"><a class="docs-heading-anchor" href="#Core-API">Core API</a><a id="Core-API-1"></a><a class="docs-heading-anchor-permalink" href="#Core-API" title="Permalink"></a></h1><h2 id="Abstract-Types"><a class="docs-heading-anchor" href="#Abstract-Types">Abstract Types</a><a id="Abstract-Types-1"></a><a class="docs-heading-anchor-permalink" href="#Abstract-Types" title="Permalink"></a></h2><h3 id="Component-Hierarchy"><a class="docs-heading-anchor" href="#Component-Hierarchy">Component Hierarchy</a><a id="Component-Hierarchy-1"></a><a class="docs-heading-anchor-permalink" href="#Component-Hierarchy" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.AbstractOpticalComponent" href="#FluxOptics.OpticalComponents.AbstractOpticalComponent"><code>FluxOptics.OpticalComponents.AbstractOpticalComponent</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AbstractOpticalComponent{M}</code></pre><p>Abstract supertype for all optical components in FluxOptics.</p><p>Root type for the optical component hierarchy, encompassing both sources that generate fields and pipe components that transform fields. The type parameter <code>M</code> indicates the trainability and buffering strategy.</p><p><strong>Type Parameter</strong></p><ul><li><code>M::Trainability</code>: Component trainability (<code>Static</code>, <code>Trainable{Buffered}</code>, etc.)</li></ul><p><strong>Subtypes</strong></p><ul><li><a href="#FluxOptics.OpticalComponents.AbstractOpticalSource"><code>AbstractOpticalSource</code></a>: Components that generate optical fields</li><li><a href="#FluxOptics.OpticalComponents.AbstractPipeComponent"><code>AbstractPipeComponent</code></a>: Components that transform optical fields</li></ul><p>See also: <a href="#FluxOptics.OpticalComponents.Trainability"><code>Trainability</code></a>, <a href="#FluxOptics.OpticalComponents.get_data"><code>get_data</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L254-L271">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.AbstractOpticalSource" href="#FluxOptics.OpticalComponents.AbstractOpticalSource"><code>FluxOptics.OpticalComponents.AbstractOpticalSource</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AbstractOpticalSource{M} &lt;: AbstractOpticalComponent{M}</code></pre><p>Abstract type for optical components that generate fields.</p><p>Sources create optical fields from nothing (like a light source), as opposed to <code>AbstractPipeComponent</code> which transform existing fields. Sources are typically placed at the beginning of optical systems.</p><p><strong>Type Parameter</strong></p><ul><li><code>M::Trainability</code>: <code>Static</code>, <code>Trainable{Unbuffered}</code>, or <code>Trainable{Buffered}</code></li></ul><p><strong>Subtypes</strong></p><ul><li><a href="#FluxOptics.OpticalComponents.AbstractCustomSource"><code>AbstractCustomSource</code></a>: Sources with custom generation logic</li><li><a href="#FluxOptics.OpticalComponents.AbstractPureSource"><code>AbstractPureSource</code></a>: Sources with simple generation</li></ul><p><strong>Required Interface</strong></p><p>All subtypes must implement:</p><ul><li><code>propagate(source)</code>: Generate the optical field</li><li><code>get_data(source)</code>: Access to source parameters</li></ul><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; u = ScalarField(ones(ComplexF64, 64, 64), (2.0, 2.0), 1.064);

julia&gt; source = ScalarSource(u; trainable=true);

julia&gt; field = propagate(source);</code></pre><p>See also: <a href="#FluxOptics.OpticalComponents.AbstractPipeComponent"><code>AbstractPipeComponent</code></a>, <a href="../../sources/sources/#FluxOptics.OpticalComponents.ScalarSource"><code>ScalarSource</code></a>, <a href="#FluxOptics.OpticalComponents.propagate"><code>propagate</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L818-L849">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.AbstractPureSource" href="#FluxOptics.OpticalComponents.AbstractPureSource"><code>FluxOptics.OpticalComponents.AbstractPureSource</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AbstractPureSource{M} &lt;: AbstractOpticalSource{M}</code></pre><p>Abstract type for stateless optical sources with direct generation.</p><p>Pure sources generate optical fields through direct computation without  maintaining internal state, suitable for simple or static source configurations.</p><p><strong>Type Parameter</strong></p><ul><li><code>M::Trainability</code>: Usually <code>Static</code>, but can support simple trainable cases</li></ul><p><strong>Required Methods</strong></p><p>All subtypes must implement:</p><ul><li><code>propagate(source)</code>: Generate the optical field directly</li><li><code>get_data(source)</code>: Access to source parameters</li></ul><p>See also: <a href="#FluxOptics.OpticalComponents.AbstractCustomSource"><code>AbstractCustomSource</code></a>, <a href="../../sources/sources/#FluxOptics.OpticalComponents.ScalarSource"><code>ScalarSource</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L856-L873">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.AbstractCustomSource" href="#FluxOptics.OpticalComponents.AbstractCustomSource"><code>FluxOptics.OpticalComponents.AbstractCustomSource</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AbstractCustomSource{M} &lt;: AbstractOpticalSource{M}</code></pre><p>Abstract type for stateful optical sources with custom generation logic.</p><p>Custom sources maintain internal state and support gradient computation for  trainable source parameters like beam profiles, power levels, etc.</p><p><strong>Type Parameter</strong></p><ul><li><code>M::Trainability</code>: Determines gradient and buffer management</li></ul><p><strong>Required Methods</strong></p><p>All subtypes must implement:</p><ul><li><code>propagate(source)</code>: Generate the optical field</li><li><code>get_data(source)</code>: Access to trainable parameters</li><li><code>trainable(source)</code>: Return trainable parameters (if <code>M &lt;: Trainable</code>)</li></ul><p><strong>Optional Methods (for optimization)</strong></p><ul><li><code>get_preallocated_gradient(source)</code>: Pre-allocated gradients (if buffered)</li><li><code>backpropagate_with_gradient(∂v, ∂p, source)</code>: Gradient backpropagation</li></ul><p>See also: <a href="#FluxOptics.OpticalComponents.AbstractPureSource"><code>AbstractPureSource</code></a>, <a href="../../sources/sources/#FluxOptics.OpticalComponents.ScalarSource"><code>ScalarSource</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L876-L898">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.AbstractPipeComponent" href="#FluxOptics.OpticalComponents.AbstractPipeComponent"><code>FluxOptics.OpticalComponents.AbstractPipeComponent</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AbstractPipeComponent{M} &lt;: AbstractOpticalComponent{M}</code></pre><p>Abstract type for optical components that process incident fields.</p><p>Pipe components transform optical fields that pass through them (like a pipe transforms fluid flow), as opposed to <code>AbstractOpticalSource</code> which generate  fields from nothing. The type parameter <code>M</code> indicates trainability.</p><p><strong>Type Parameter</strong></p><ul><li><code>M::Trainability</code>: <code>Static</code>, <code>Trainable{Unbuffered}</code>, or <code>Trainable{Buffered}</code></li></ul><p><strong>Subtypes</strong></p><ul><li><a href="#FluxOptics.OpticalComponents.AbstractCustomComponent"><code>AbstractCustomComponent</code></a>: Stateful components with custom propagation</li><li><a href="#FluxOptics.OpticalComponents.AbstractPureComponent"><code>AbstractPureComponent</code></a>: Stateless components with simple propagation</li></ul><p><strong>Required Interface</strong></p><p>All subtypes must implement:</p><ul><li><code>propagate!(u, component, direction)</code> or <code>propagate(u, component, direction)</code></li><li><code>get_data(component)</code>: Access to component parameters</li></ul><p>See also: <a href="#FluxOptics.OpticalComponents.AbstractOpticalSource"><code>AbstractOpticalSource</code></a>, <a href="#FluxOptics.OpticalComponents.propagate!"><code>propagate!</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L475-L497">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.AbstractPureComponent" href="#FluxOptics.OpticalComponents.AbstractPureComponent"><code>FluxOptics.OpticalComponents.AbstractPureComponent</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AbstractPureComponent{M} &lt;: AbstractPipeComponent{M}</code></pre><p>Abstract type for optical components with functional interface.</p><p>Pure components provide a functional interface where the same input always gives the same output, without requiring manual implementation of gradient rules. They can wrap complex internal state (including <code>AbstractCustomComponent</code>s) but expose a pure functional interface that works seamlessly with automatic differentiation.</p><p><strong>Type Parameter</strong></p><ul><li><code>M::Trainability</code>: Usually <code>Static</code>, but can support <code>Trainable</code> for Zygote-based components</li></ul><p><strong>Required Methods</strong></p><p>All subtypes must implement:</p><ul><li><code>propagate(u, component, direction)</code>: Direct field transformation</li><li><code>get_data(component)</code>: Access to component parameters</li></ul><p><strong>Characteristics</strong></p><ul><li><strong>Functional interface</strong>: Same input → same output, regardless of internal complexity</li><li><strong>Zygote compatible</strong>: Automatic differentiation works without custom rules</li><li><strong>Composable</strong>: Can wrap and combine other components</li><li><strong>Implementation agnostic</strong>: Internal state hidden behind pure interface</li></ul><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; u = ScalarField(ones(ComplexF64, 64, 64), (2.0, 2.0), 1.064);

julia&gt; prop_z = ASPropZ(u, 500.0; trainable=true);

julia&gt; typeof(prop_z) &lt;: AbstractPureComponent
true</code></pre><p>See also: <a href="#FluxOptics.OpticalComponents.AbstractCustomComponent"><code>AbstractCustomComponent</code></a>, <a href="../../freespace/freespace/#FluxOptics.OpticalComponents.ASPropZ"><code>ASPropZ</code></a>, <a href="../../system/system/#FluxOptics.OpticalComponents.OpticalSequence"><code>OpticalSequence</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L500-L535">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.AbstractCustomComponent" href="#FluxOptics.OpticalComponents.AbstractCustomComponent"><code>FluxOptics.OpticalComponents.AbstractCustomComponent</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AbstractCustomComponent{M} &lt;: AbstractPipeComponent{M}</code></pre><p>Abstract type for stateful optical components with custom propagation logic.</p><p>Custom components maintain internal state, support gradient computation for  optimization, and implement complex propagation behavior. They are the building blocks for trainable optical elements like phase masks, diffractive elements, etc.</p><p><strong>Type Parameter</strong></p><ul><li><code>M::Trainability</code>: Determines gradient and buffer management</li></ul><p><strong>Required Methods</strong></p><p>All subtypes must implement:</p><ul><li><code>propagate!(u, component, direction)</code>: In-place field transformation</li><li><code>get_data(component)</code>: Access to trainable parameters  </li><li><code>trainable(component)</code>: Return trainable parameters (if <code>M &lt;: Trainable</code>)</li></ul><p><strong>Optional Methods (for optimization)</strong></p><ul><li><code>backpropagate!(u, component, direction)</code>: Reverse propagation</li><li><code>get_preallocated_gradient(component)</code>: Pre-allocated gradients (if buffered)</li><li><code>alloc_saved_buffer(u, component)</code>: Allocate forward-pass buffers</li></ul><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; u = ScalarField(ones(ComplexF64, 64, 64), (2.0, 2.0), 1.064);

julia&gt; phase_mask = Phase(u, (x, y) -&gt; 0.1*x^2; trainable=true);

julia&gt; typeof(phase_mask) &lt;: AbstractCustomComponent
true

julia&gt; propagate!(u, phase_mask, Forward);</code></pre><p>See also: <a href="#FluxOptics.OpticalComponents.AbstractPureComponent"><code>AbstractPureComponent</code></a>, <a href="../../modulators/modulators/#FluxOptics.OpticalComponents.Phase"><code>Phase</code></a>, <a href="../../modulators/modulators/#FluxOptics.OpticalComponents.Mask"><code>Mask</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L714-L750">source</a></section></article><h2 id="Trainability-System"><a class="docs-heading-anchor" href="#Trainability-System">Trainability System</a><a id="Trainability-System-1"></a><a class="docs-heading-anchor-permalink" href="#Trainability-System" title="Permalink"></a></h2><h3 id="Types"><a class="docs-heading-anchor" href="#Types">Types</a><a id="Types-1"></a><a class="docs-heading-anchor-permalink" href="#Types" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.Trainability" href="#FluxOptics.OpticalComponents.Trainability"><code>FluxOptics.OpticalComponents.Trainability</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Trainability</code></pre><p>Abstract type for trainability classification of optical components.</p><p>Defines whether a component&#39;s parameters can be optimized and how gradients are managed during automatic differentiation.</p><p><strong>Subtypes</strong></p><ul><li><a href="#FluxOptics.OpticalComponents.Static"><code>Static</code></a>: Non-trainable component</li><li><a href="#FluxOptics.OpticalComponents.Trainable"><code>Trainable{Buffering}</code></a>: Trainable component with buffer management</li></ul><p>See also: <a href="../#Buffering"><code>Buffering</code></a>, <a href="#FluxOptics.OpticalComponents.Trainability"><code>Trainability</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L173-L186">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.Static" href="#FluxOptics.OpticalComponents.Static"><code>FluxOptics.OpticalComponents.Static</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Static &lt;: Trainability</code></pre><p>Trainability type for non-optimizable optical components.</p><p>Components with <code>Static</code> trainability have fixed parameters that cannot be modified during optimization. These components are more efficient as they don&#39;t allocate gradients or maintain optimization state.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; u = ScalarField(ones(ComplexF64, 64, 64), (2.0, 2.0), 1.064);

julia&gt; lens = FourierLens(u, (2.0, 2.0), 1000.0);  # Static by default

julia&gt; typeof(lens) &lt;: AbstractPipeComponent{Static}
true</code></pre><p>See also: <a href="#FluxOptics.OpticalComponents.Trainable"><code>Trainable</code></a>, <a href="#FluxOptics.OpticalComponents.Trainability"><code>Trainability</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L189-L209">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.Trainable" href="#FluxOptics.OpticalComponents.Trainable"><code>FluxOptics.OpticalComponents.Trainable</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Trainable{B &lt;: Buffering} &lt;: Trainability</code></pre><p>Trainability type for optimizable optical components.</p><p>Components with <code>Trainable</code> trainability have parameters that can be optimized during training. The type parameter <code>B</code> controls gradient and buffer allocation strategy for performance optimization.</p><p><strong>Type Parameter</strong></p><ul><li><code>B::Buffering</code>: <a href="#FluxOptics.OpticalComponents.Buffered"><code>Buffered</code></a> or <a href="#FluxOptics.OpticalComponents.Unbuffered"><code>Unbuffered</code></a></li></ul><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; u = ScalarField(ones(ComplexF64, 64, 64), (2.0, 2.0), 1.064);

julia&gt; phase_mask = Phase(u, (x, y) -&gt; 0.0; trainable=true, buffered=true);

julia&gt; typeof(phase_mask) &lt;: AbstractPipeComponent{&lt;:Trainable}
true</code></pre><p>See also: <a href="#FluxOptics.OpticalComponents.Static"><code>Static</code></a>, <a href="../#Buffering"><code>Buffering</code></a>, <a href="#FluxOptics.OpticalComponents.Trainable"><code>Trainable</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L212-L235">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.Buffering" href="#FluxOptics.OpticalComponents.Buffering"><code>FluxOptics.OpticalComponents.Buffering</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Buffering</code></pre><p>Abstract type for gradient and buffer allocation strategy.</p><p>Controls how memory is managed for trainable components during optimization, allowing trade-offs between performance and memory usage.</p><p><strong>Subtypes</strong></p><ul><li><a href="#FluxOptics.OpticalComponents.Buffered"><code>Buffered</code></a>: Pre-allocated buffers for maximum performance</li><li><a href="#FluxOptics.OpticalComponents.Unbuffered"><code>Unbuffered</code></a>: Dynamic allocation for memory efficiency</li></ul><p>See also: <a href="#FluxOptics.OpticalComponents.Trainable"><code>Trainable</code></a>, <a href="#FluxOptics.OpticalComponents.Trainability"><code>Trainability</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L101-L114">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.Buffered" href="#FluxOptics.OpticalComponents.Buffered"><code>FluxOptics.OpticalComponents.Buffered</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Buffered &lt;: Buffering</code></pre><p>Buffering strategy with pre-allocated gradient and forward-pass buffers.</p><p>Components using <code>Buffered</code> pre-allocate all necessary buffers during construction, providing maximum performance during optimization at the cost of higher memory usage. Recommended for production training and repeated optimizations.</p><p><strong>Advantages</strong></p><ul><li><strong>Maximum performance</strong>: No allocation overhead during training</li><li><strong>Predictable memory</strong>: All buffers allocated upfront</li><li><strong>GPU friendly</strong>: Reduces memory fragmentation</li></ul><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; u = ScalarField(ones(ComplexF64, 64, 64), (2.0, 2.0), 1.064);

julia&gt; mask = Mask(u, (x, y) -&gt; 1.0; trainable=true, buffered=true);

julia&gt; typeof(mask) &lt;: AbstractPipeComponent{Trainable{Buffered}}
true</code></pre><p>See also: <a href="#FluxOptics.OpticalComponents.Unbuffered"><code>Unbuffered</code></a>, <a href="#FluxOptics.OpticalComponents.Trainability"><code>Trainability</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L117-L142">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.Unbuffered" href="#FluxOptics.OpticalComponents.Unbuffered"><code>FluxOptics.OpticalComponents.Unbuffered</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Unbuffered &lt;: Buffering</code></pre><p>Buffering strategy with dynamic allocation of gradients and buffers.</p><p>Components using <code>Unbuffered</code> allocate gradients and buffers as needed during optimization, providing memory efficiency at the cost of allocation overhead. Recommended for prototyping and memory-constrained environments.</p><p><strong>Advantages</strong></p><ul><li><strong>Memory efficient</strong>: Only allocates what&#39;s needed</li><li><strong>Flexible</strong>: Easy to modify component structure</li><li><strong>Debug friendly</strong>: Clear allocation patterns</li></ul><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; u = ScalarField(ones(ComplexF64, 64, 64), (2.0, 2.0), 1.064);

julia&gt; phase_mask = Phase(u, (x, y) -&gt; 0.0; trainable=true, buffered=false);

julia&gt; typeof(phase_mask) &lt;: AbstractPipeComponent{Trainable{Unbuffered}}
true</code></pre><p>See also: <a href="#FluxOptics.OpticalComponents.Buffered"><code>Buffered</code></a>, <a href="#FluxOptics.OpticalComponents.Trainability"><code>Trainability</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L145-L170">source</a></section></article><h3 id="Query-Functions"><a class="docs-heading-anchor" href="#Query-Functions">Query Functions</a><a id="Query-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Query-Functions" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.istrainable" href="#FluxOptics.OpticalComponents.istrainable"><code>FluxOptics.OpticalComponents.istrainable</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">istrainable(component::AbstractOpticalComponent) -&gt; Bool</code></pre><p>Check if a component is trainable (has optimizable parameters).</p><p>Returns <code>true</code> for components created with <code>trainable=true</code>, <code>false</code> otherwise.</p><p><strong>Examples</strong></p><pre><code class="language-julia hljs">phase_static = Phase(u, (x, y) -&gt; x^2)
istrainable(phase_static)  # false

phase_train = Phase(u, (x, y) -&gt; 0.0; trainable=true)
istrainable(phase_train)  # true</code></pre><p>See also: <a href="#FluxOptics.OpticalComponents.isbuffered"><code>isbuffered</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L276-L293">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.isbuffered" href="#FluxOptics.OpticalComponents.isbuffered"><code>FluxOptics.OpticalComponents.isbuffered</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">isbuffered(component::AbstractOpticalComponent) -&gt; Bool</code></pre><p>Check if a trainable component uses pre-allocated gradient buffers.</p><p>Returns <code>true</code> for components created with <code>trainable=true, buffered=true</code>, <code>false</code> otherwise.</p><p><strong>Examples</strong></p><pre><code class="language-julia hljs">phase_unbuf = Phase(u, (x, y) -&gt; 0.0; trainable=true, buffered=false)
isbuffered(phase_unbuf)  # false

phase_buf = Phase(u, (x, y) -&gt; 0.0; trainable=true, buffered=true)
isbuffered(phase_buf)  # true</code></pre><p>See also: <a href="#FluxOptics.OpticalComponents.istrainable"><code>istrainable</code></a>, <a href="#FluxOptics.OpticalComponents.Buffered"><code>Buffered</code></a>, <a href="#FluxOptics.OpticalComponents.Unbuffered"><code>Unbuffered</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L297-L315">source</a></section></article><h2 id="Propagation"><a class="docs-heading-anchor" href="#Propagation">Propagation</a><a id="Propagation-1"></a><a class="docs-heading-anchor-permalink" href="#Propagation" title="Permalink"></a></h2><h3 id="Direction-Types"><a class="docs-heading-anchor" href="#Direction-Types">Direction Types</a><a id="Direction-Types-1"></a><a class="docs-heading-anchor-permalink" href="#Direction-Types" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.Direction" href="#FluxOptics.OpticalComponents.Direction"><code>FluxOptics.OpticalComponents.Direction</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Direction</code></pre><p>Abstract type for specifying propagation direction (Forward or Backward)</p><p>See also: <a href="#FluxOptics.OpticalComponents.Forward"><code>Forward</code></a>, <a href="#FluxOptics.OpticalComponents.Backward"><code>Backward</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L27-L33">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.Forward" href="#FluxOptics.OpticalComponents.Forward"><code>FluxOptics.OpticalComponents.Forward</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Forward</code></pre><p>Direction marker type for forward optical propagation.</p><p>Used as a type parameter in propagation functions to indicate the direction of light propagation. Forward propagation follows the positive z-axis direction.</p><p>See also: <a href="#FluxOptics.OpticalComponents.Backward"><code>Backward</code></a>, <a href="#FluxOptics.OpticalComponents.propagate!"><code>propagate!</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L36-L45">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.Backward" href="#FluxOptics.OpticalComponents.Backward"><code>FluxOptics.OpticalComponents.Backward</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Backward</code></pre><p>Direction marker type for backward optical propagation.</p><p>Used as a type parameter in propagation functions to indicate the direction of light propagation along the negative z-axis direction.</p><p>See also: <a href="#FluxOptics.OpticalComponents.Forward"><code>Forward</code></a>, <a href="#FluxOptics.OpticalComponents.propagate!"><code>propagate!</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L48-L57">source</a></section></article><h3 id="Propagation-Functions"><a class="docs-heading-anchor" href="#Propagation-Functions">Propagation Functions</a><a id="Propagation-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Propagation-Functions" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.propagate" href="#FluxOptics.OpticalComponents.propagate"><code>FluxOptics.OpticalComponents.propagate</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">propagate(u::ScalarField, component::AbstractPipeComponent, direction::Type{&lt;:Direction})
propagate(source::AbstractOpticalSource)</code></pre><p>Propagate an optical field through a component or generate a field from a source.</p><p>The first form creates a copy of the input field and applies the optical transformation  defined by <code>component</code> in the specified <code>direction</code>. The second form generates a new optical field from a source component.</p><p><strong>Arguments</strong></p><ul><li><code>u::ScalarField</code>: Input optical field (unchanged)</li><li><code>component</code>: Optical component to propagate through  </li><li><code>direction::Type{&lt;:Direction}</code>: <code>Forward</code> or <code>Backward</code> propagation</li><li><code>source::AbstractOpticalSource</code>: Source component to generate field from</li></ul><p><strong>Returns</strong></p><p>New <code>ScalarField</code> with the transformation applied or generated.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; u = ScalarField(ones(ComplexF64, 64, 64), (2.0, 2.0), 1.064);

julia&gt; phase_mask = Phase(u, (x, y) -&gt; 0.1*(x^2 + y^2));

julia&gt; u_prop = propagate(u, phase_mask, Forward);

julia&gt; source = ScalarSource(u; trainable=true);

julia&gt; u_generated = propagate(source);

julia&gt; size(u_generated) == size(u)
true</code></pre><p>See also: <a href="#FluxOptics.OpticalComponents.propagate!"><code>propagate!</code></a>, <a href="#FluxOptics.OpticalComponents.Forward"><code>Forward</code></a>, <a href="#FluxOptics.OpticalComponents.Backward"><code>Backward</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L538-L574">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.propagate!" href="#FluxOptics.OpticalComponents.propagate!"><code>FluxOptics.OpticalComponents.propagate!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">propagate!(u::ScalarField, component::AbstractPipeComponent, direction::Type{&lt;:Direction})</code></pre><p>Propagate field through component in-place, modifying the input field.</p><p>This is the core in-place propagation method that modifies the field as it passes through the optical component. The field is transformed according to the component&#39;s optical properties in the specified direction.</p><p><strong>Arguments</strong></p><ul><li><code>u::ScalarField</code>: Field to propagate (modified in-place)</li><li><code>component</code>: Optical component to propagate through</li><li><code>direction</code>: <code>Forward</code> or <code>Backward</code> propagation direction</li></ul><p><strong>Returns</strong></p><p>Modified <code>ScalarField</code> (same object as input).</p><p><strong>Examples</strong></p><pre><code class="language-julia hljs">u = ScalarField(ones(ComplexF64, 128, 128), (2.0, 2.0), 1.064)
phase = Phase(u, (x, y) -&gt; 0.1*x^2)

# In-place propagation
propagate!(u, phase, Forward)  # u is modified

# For sequence of components
propagate!(u, phase1, Forward)
propagate!(u, lens, Forward)
propagate!(u, phase2, Forward)</code></pre><p>See also: <a href="#FluxOptics.OpticalComponents.propagate"><code>propagate</code></a>, <a href="#FluxOptics.OpticalComponents.Forward"><code>Forward</code></a>, <a href="#FluxOptics.OpticalComponents.Backward"><code>Backward</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L579-L611">source</a></section></article><h2 id="Component-Interface"><a class="docs-heading-anchor" href="#Component-Interface">Component Interface</a><a id="Component-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Component-Interface" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.get_data" href="#FluxOptics.OpticalComponents.get_data"><code>FluxOptics.OpticalComponents.get_data</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_data(component::AbstractOpticalComponent)</code></pre><p>Access the internal data array(s) of an optical component.</p><p>Returns the underlying parameter array (phase, mask, etc.) or tuple of arrays for components with multiple parameters. Used for inspection and direct manipulation.</p><p><strong>Returns</strong></p><ul><li>Single <code>AbstractArray</code> for simple components (Phase, Mask)</li><li><code>Tuple</code> of arrays for components with multiple parameters</li><li>May be on GPU if component was constructed with GPU arrays</li></ul><p><strong>Examples</strong></p><pre><code class="language-julia hljs">phase = Phase(u, (x, y) -&gt; x^2; trainable=true)
φ = get_data(phase)  # Returns phase array</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L319-L337">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FluxOptics.OpticalComponents.trainable-Tuple{AbstractOpticalComponent{Static}}" href="#FluxOptics.OpticalComponents.trainable-Tuple{AbstractOpticalComponent{Static}}"><code>FluxOptics.OpticalComponents.trainable</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">trainable(component::AbstractOpticalComponent)</code></pre><p>Return trainable parameters of a component as a NamedTuple.</p><p>For <code>Static</code> components, returns an empty <code>NamedTuple{}()</code>. For <code>Trainable</code> components, returns a <code>NamedTuple</code> with parameter names as keys and parameter arrays as values.</p><p><strong>Returns</strong></p><ul><li><code>NamedTuple{}()</code> for static components</li><li><code>NamedTuple</code> with parameter arrays for trainable components</li></ul><p><strong>Examples</strong></p><pre><code class="language-julia hljs"># Static component
phase_static = Phase(u, (x, y) -&gt; x^2)
trainable(phase_static)  # NamedTuple{}()

# Trainable component
phase_train = Phase(u, (x, y) -&gt; 0.0; trainable=true)
params = trainable(phase_train)  # (; ϕ = ...)

# Use with optimization
using Functors
all_params = Functors.fmap(trainable, system)</code></pre><p>See also: <a href="#FluxOptics.OpticalComponents.istrainable"><code>istrainable</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/anscoil/FluxOptics.jl/blob/931edbe8c5e8c6807089b668bfd4d00efb616db7/src/optical_components/OpticalComponents.jl#L439-L468">source</a></section></article><h2 id="Technical-Notes"><a class="docs-heading-anchor" href="#Technical-Notes">Technical Notes</a><a id="Technical-Notes-1"></a><a class="docs-heading-anchor-permalink" href="#Technical-Notes" title="Permalink"></a></h2><h3 id="Trainability-vs-Buffering"><a class="docs-heading-anchor" href="#Trainability-vs-Buffering">Trainability vs Buffering</a><a id="Trainability-vs-Buffering-1"></a><a class="docs-heading-anchor-permalink" href="#Trainability-vs-Buffering" title="Permalink"></a></h3><p><strong>Trainability</strong> determines if parameters can be optimized:</p><ul><li><code>Static</code>: No optimization, no gradient tracking</li><li><code>Trainable</code>: Parameters can be optimized</li></ul><p><strong>Buffering</strong> determines memory allocation strategy for trainable components:</p><ul><li><code>Unbuffered</code>: Allocates gradient buffers on-demand during backpropagation</li><li><code>Buffered</code>: Pre-allocates gradient and forward buffers at construction</li></ul><p><strong>Performance trade-offs:</strong></p><pre><code class="language-julia hljs"># Unbuffered: lower memory, slower for many iterations
component = Phase(u, (x, y) -&gt; 0.0; trainable=true, buffered=false)

# Buffered: higher memory, faster for iterative optimization
component = Phase(u, (x, y) -&gt; 0.0; trainable=true, buffered=true)</code></pre><h3 id="Direction-Handling"><a class="docs-heading-anchor" href="#Direction-Handling">Direction Handling</a><a id="Direction-Handling-1"></a><a class="docs-heading-anchor-permalink" href="#Direction-Handling" title="Permalink"></a></h3><p>Components implement bidirectional propagation:</p><ul><li><code>Forward</code>: Default direction, positive z-axis</li><li><code>Backward</code>: Reverse direction, negative z-axis</li></ul><p>Some components behave identically in both directions (e.g., phase masks), while others change behavior (e.g., amplifiers, gain media).</p><pre><code class="language-julia hljs"># Symmetric component (phase mask)
phase = Phase(u, (x, y) -&gt; x^2)
u_fwd = propagate(u, phase, Forward)
u_bwd = propagate(u, phase, Backward)
# |u_fwd| == |u_bwd| (identical except for tilt handling)

# Asymmetric component (gain sheet)
gain = GainSheet(u, 2.0)  # 2x amplification
u_fwd = propagate(u, gain, Forward)   # Amplified
u_bwd = propagate(u, gain, Backward)  # Also amplified in backward</code></pre><h3 id="Pure-vs-Custom-Components"><a class="docs-heading-anchor" href="#Pure-vs-Custom-Components">Pure vs Custom Components</a><a id="Pure-vs-Custom-Components-1"></a><a class="docs-heading-anchor-permalink" href="#Pure-vs-Custom-Components" title="Permalink"></a></h3><p><strong>Pure Components</strong> (<code>AbstractPureComponent</code>):</p><ul><li>Functional interface: same input → same output</li><li>No manual gradient rules needed</li><li>Zygote handles differentiation automatically</li><li>Can wrap complex internal state or <code>AbstractCustomComponent</code></li><li>Examples: <code>ASPropZ</code>, <code>OpticalSequence</code>, <code>FourierWrapper</code></li></ul><p><strong>Custom Components</strong> (<code>AbstractCustomComponent</code>):</p><ul><li>Maintain explicit internal state</li><li>Custom gradient implementations</li><li>More control over memory and computation</li><li>Better performance for specific operations</li><li>Examples: <code>Phase</code>, <code>Mask</code>, <code>ASProp</code>, <code>BPM</code></li></ul><pre><code class="language-julia hljs"># Pure component: Zygote-compatible propagation
prop_pure = ASPropZ(u, 500.0; trainable=true)

# Custom component: explicit forward/backward passes
prop_custom = ASProp(u, 500.0; trainable=true)

# Both work in systems, but have different internal implementations</code></pre><h3 id="Source-vs-Pipe-Components"><a class="docs-heading-anchor" href="#Source-vs-Pipe-Components">Source vs Pipe Components</a><a id="Source-vs-Pipe-Components-1"></a><a class="docs-heading-anchor-permalink" href="#Source-vs-Pipe-Components" title="Permalink"></a></h3><p><strong>Sources</strong> (<code>AbstractOpticalSource</code>):</p><ul><li>Generate fields from nothing</li><li>Take no input field</li><li>Use <code>propagate(source)</code> (no input field argument)</li><li>Placed at beginning of optical systems</li><li>Example: <code>ScalarSource</code></li></ul><p><strong>Pipe Components</strong> (<code>AbstractPipeComponent</code>):</p><ul><li>Transform existing fields</li><li>Take input field as argument</li><li>Use <code>propagate(u, component, direction)</code></li><li>Chained with <code>|&gt;</code> operator</li><li>Examples: <code>Phase</code>, <code>Mask</code>, <code>ASProp</code>, <code>FourierLens</code></li></ul><pre><code class="language-julia hljs"># Source: generates field
source = ScalarSource(u; trainable=true)
u_out = propagate(source)  # No input field needed

# Pipe: transforms field
phase = Phase(u, (x, y) -&gt; x^2)
u_out = propagate(u, phase, Forward)  # Requires input field

# System composition
system = source |&gt; phase |&gt; propagator
result = system()  # source generates, components transform</code></pre><h3 id="Memory-and-Performance"><a class="docs-heading-anchor" href="#Memory-and-Performance">Memory and Performance</a><a id="Memory-and-Performance-1"></a><a class="docs-heading-anchor-permalink" href="#Memory-and-Performance" title="Permalink"></a></h3><p><strong>Static components:</strong></p><ul><li>No gradient allocation</li><li>Lower memory footprint</li><li>Faster forward propagation</li><li>Use for fixed optical elements</li></ul><p><strong>Trainable, unbuffered:</strong></p><ul><li>Gradients allocated during backpropagation</li><li>Lower base memory, higher peak memory</li><li>Good for single-shot optimization or limited iterations</li><li>Use when memory is tight</li></ul><p><strong>Trainable, buffered:</strong></p><ul><li>Gradients and forward buffers pre-allocated</li><li>Higher base memory, same peak memory</li><li>Fastest for iterative optimization</li><li>Use for production optimization loops</li></ul><pre><code class="language-julia hljs"># Memory comparison for 128×128 field
u = ScalarField((128, 128), (2.0, 2.0), 1.064)

# Static: ~128 KB (field data only)
phase_static = Phase(u, (x, y) -&gt; x^2)

# Trainable, unbuffered: ~128 KB base, ~256 KB peak
phase_unbuf = Phase(u, (x, y) -&gt; 0.0; trainable=true, buffered=false)

# Trainable, buffered: ~384 KB (field + gradient + buffers)
phase_buf = Phase(u, (x, y) -&gt; 0.0; trainable=true, buffered=true)</code></pre><h3 id="Component-Data-Access"><a class="docs-heading-anchor" href="#Component-Data-Access">Component Data Access</a><a id="Component-Data-Access-1"></a><a class="docs-heading-anchor-permalink" href="#Component-Data-Access" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Get component data
phase = Phase(u, (x, y) -&gt; 0.0; trainable=true)
φ = get_data(phase)  # Returns phase array

# Modify data directly (use with caution)
φ .= some_new_phase

# Get trainable parameters (for optimization)
params = trainable(phase)  # (; ϕ = φ)

# Collect from GPU
phase_gpu = Phase(u_gpu, (x, y) -&gt; 0.0)
φ_cpu = collect(phase_gpu)  # Transfer to CPU</code></pre><h2 id="Common-Patterns"><a class="docs-heading-anchor" href="#Common-Patterns">Common Patterns</a><a id="Common-Patterns-1"></a><a class="docs-heading-anchor-permalink" href="#Common-Patterns" title="Permalink"></a></h2><h3 id="Optimization-Setup"><a class="docs-heading-anchor" href="#Optimization-Setup">Optimization Setup</a><a id="Optimization-Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Optimization-Setup" title="Permalink"></a></h3><pre><code class="language-julia hljs">using Zygote, Optimisers

# Create trainable components
u = ScalarField((128, 128), (2.0, 2.0), 1.064)
source = ScalarSource(u; trainable=true, buffered=true)
phase = Phase(u, (x, y) -&gt; 0.0; trainable=true, buffered=true)
mask = Mask(u, (x, y) -&gt; 1.0; trainable=true, buffered=true)
prop = ASProp(u, 500.0)

# Build system
system = source |&gt; phase |&gt; mask |&gt; prop

# Setup optimization
target = ScalarField(target_data, (2.0, 2.0), 1.064)
metric = PowerCoupling(target)

loss() = 1.0 - metric(system())[]

# Extract trainable parameters
params = trainable(system)
opt_state = Optimisers.setup(Optimisers.Adam(0.01), params)

# Optimization loop
for iter in 1:1000
    l, grads = withgradient(loss, params)
    Optimisers.update!(opt_state, params, grads[1])
    
    if iter % 100 == 0
        println(&quot;Iteration $iter: loss = $l&quot;)
    end
end</code></pre><h3 id="Bidirectional-Propagation"><a class="docs-heading-anchor" href="#Bidirectional-Propagation">Bidirectional Propagation</a><a id="Bidirectional-Propagation-1"></a><a class="docs-heading-anchor-permalink" href="#Bidirectional-Propagation" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Forward and backward propagation through same system
u_input = ScalarField(input_data, (2.0, 2.0), 1.064)

# Forward pass
u_forward = propagate(u_input, component, Forward)

# Backward pass (e.g., for time-reversal or adjoint method)
u_backward = propagate(u_forward, component, Backward)

# For unitary components: u_backward ≈ u_input (up to numerical precision)</code></pre><h3 id="Component-Inspection"><a class="docs-heading-anchor" href="#Component-Inspection">Component Inspection</a><a id="Component-Inspection-1"></a><a class="docs-heading-anchor-permalink" href="#Component-Inspection" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Query component properties
comp = Phase(u, (x, y) -&gt; 0.0; trainable=true, buffered=true)

istrainable(comp)  # true
isbuffered(comp)   # true
length(comp)       # 1 (atomic component)

# Extract information
data = get_data(comp)
params = trainable(comp)
data_cpu = collect(comp)
</code></pre><h2 id="See-Also"><a class="docs-heading-anchor" href="#See-Also">See Also</a><a id="See-Also-1"></a><a class="docs-heading-anchor-permalink" href="#See-Also" title="Permalink"></a></h2><ul><li><a href="../../sources/">Sources</a> for field generation components</li><li><a href="../../modulators/">Modulators</a> for phase and amplitude modulation</li><li><a href="../../freespace/">Free-Space Propagators</a> for propagation methods</li><li><a href="../../system/">System</a> for building optical sequences and complex optical systems</li><li><a href="../../../optimisers/">OptimisersExt</a> for optimization tools</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Core</a><a class="docs-footer-nextpage" href="../../sources/">Sources »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Friday 10 October 2025 23:09">Friday 10 October 2025</span>. Using Julia version 1.12.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
